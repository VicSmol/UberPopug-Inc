# Analytics service

## Почему???

- Изолировать запись и чтение аналитики от других сервисов
- Изолировать менеджмент аналитики от остальный процессов

## Компоненты

- Реплицированная база данных (для обеспечения отказоустойчисвости данного сервиса)
- REST API
- Kafka продюсер для добавления эвентов в Kafka
- Kafka консюмер для обработки эвентов из Kafka
- Cron job для отправки статистики и отправки данных дла email рассылки

## Данные

Данный сервис содержит информацию об аккаунтах:

- amount

Об account logs:

- task_description
- log type (incoming, expense)
- amount

Статистику:

- revenue
- date

## Синхронные операции (Rest API)

- получения списка пользователей
- получение баланса + логов для обычного пользователя
- получение статистики за день/несколько дней для администраторов и бухгалтеров

## Асинхронные операции

- обновление баланса по событию создания задачи
- обновление баланса по событию окончания задачи

## Workflows

- Пользователь шлет синхронный запрос на получение логов и баланса
- Пользователь шлет запрос на получение дневной статистики и статистики по дням
- На евент по созданию задачи -> списываем сумму с баланса -> создаем audit log -> пересчитываем статистику за текущий
  день
- На евент по завершению задачи -> зачислем сумму на баланс -> создаем audit log -> пересчитываем статистику за текущий
  день
- Каждый день вечером -> берем балансы всех пользователей и статистику за текущий день -> оплавляем полученные данные в
  daily statistics event -> онулируем положительные балансы
